<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <!-- Primary Meta Tags -->
  <!-- {% block title %} &mdash Distribuição de Plantio {% endblock %} -->

  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="title" content="Refloresta SP &mdash Distribuição de Plantio">
  <meta name="author" content="Equipe `Refloresta SP`">
  <meta name="description" content="">

  <link rel="icon" type="image/png" sizes="16x16" href="../../static/assets/img/favicon/favicon-16x16.jpg">

  <!-- Fontawesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w=="
    crossorigin="anonymous" referrerpolicy="no-referrer">

  <!-- CSS -->
  <link type="text/css" href="../../static/assets/css/pixel.css" rel="stylesheet">
  <link type="text/css" href="../../static/assets/css/refloresta.css" rel="stylesheet">
  <script>
    let iSelectedIx = -1;
    let jsBlocks = null;
    const _next = () => {
      if (iSelectedIx < 0) {
        alert('Favor selecione uma das opções.');
      } else { // if (confirm('Confirma a seleção?')) {
        const id = jsBlocks[iSelectedIx].id;
        window.location.href = `./rsp-relief.html?id=${id}`;
      }
    }
    const _error = (sMsg) =>{


    }
    const _select = (ix) => {
      if (iSelectedIx != ix) {
        iSelectedIx = ix;
        const eleUsDisplay = document.getElementById('idWzdUsDisplay');
        eleUsDisplay.innerHTML = `Selecionado: <b>${jsBlocks[iSelectedIx].caption}</b>`;
        eleUsDisplay.classList.remove('visually-hidden');
        _display(null);
      }
    }
    const _display = (jsData) => {
      if (jsData) { jsBlocks = jsData; }
      const sPath = '../../static/assets/img/modelo_plantio/';
      const htmCol = '<div class="col text-center mb-3">'
      let sHtml = /* htmlRow */ '<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4">';
      jsBlocks.forEach((itm, i) => {
        let onClick = `onclick="_select(${i})`;
        sHtml += htmCol + // <htmCol>
          `<button class="mb-2 btn btn-${(i == iSelectedIx) ? 'warning' : 'info'} bg-gradient" type="button" style="height:4.2em; width:100%" ${onClick}">${itm.caption}</button>` +
          `<a ${onClick}"> <img src="${sPath}${itm.fileName}.png" alt="${itm.fileName}"></a>` +
          '</div>'; /* </htmCol>  */
      });
      sHtml += '</div>'; // htmlRow
      document.getElementById('idWzdBody').innerHTML = sHtml;
    }
  </script>
</head>

<body>
  <!-- version 0.4 2022.12.20 mgd -->
  <div style="margin-top: 2%">
    <div class="wzdContainer">

      <!-- header -->
      <div class="wzdHeader">
        <table>
          <tr>
            <td class="wzdLogo"></td>
            <td>
              <h6 class="alert-heading">Distribuição de Plantio</h6>
              <div>Selecione a distribuição segundo o tipo de faixas</div>
            </td>
          </tr>
        </table>
      </div>
      <!-- end header -->

      <!-- =========    Usar de Aqui ======= -->
      <!-- body -->
      <div id="idWzdBody" class="wzdBody container">
        <!-- <div id="grdModelos" class="container"> -->
          <div class="text-center text-warning" style="height: 30em; width: 100%">
            <span class="spinner-border" style="height: 20%;"></span>
            <h4>Aguarde...</h4>
          </div>
        <!-- </div> -->
      </div>
      <!-- end body -->
      <!-- =========    Até de Aqui ======= -->


      <!-- Next button -->
      <div class="wzdFooter">
        <div id= "idWzdUsDisplay" class="wzdUsDisplay visually-hidden"></div>
        <button class="wzdBtnNext btn btn-primary" type="button" onclick="_next();">Ok</button>
      </div>
    </div>
  </div>

  <script>
    async function getDistribution() {
      const response = await fetch('/callback/getDistribution');
      if (!response.ok) {
        alert(`HTTP-Error: ${response.status} on callback().`);
      } else {
        const jsoRsp = await response.json();
        const jsData = jsoRsp.data;
        let iLng = jsData.length;
        if (iLng == 0) {
          _error('Não exitem distribuições para esta configuração.');
        } else {
          _display(jsData);
        }
      }
    }
    getDistribution();
  </script>

  {% include 'includes/scripts.html' %} {% block javascripts %} {% endblock javascripts %}
</body>

</html>